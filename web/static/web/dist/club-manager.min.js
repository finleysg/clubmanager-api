!function(){"use strict";function e(e){function t(t){var n=e.absUrl(),a=n.indexOf(t);return a>0}function n(t){var n=e.absUrl(),a=!1;return t.forEach(function(e){n.indexOf(e)>0&&(a=!0)}),a}var a=this;a.isActive=t,a.isOpen=n}function t(e,t){for(var n=moment([t,e,1]),a=n.day();a>0;)n.add(-1,"d"),a=n.day();return n}function n(e,t){for(var n=[],r=!1,i=e.clone(),o=i.month(),c=0;!r;)n.push({days:a(i.clone(),t)}),i.add(1,"w"),r=c++>2&&o!==i.month(),o=i.month();return n}function a(e,t){for(var n=[],a=0;7>a;a++)n.push(new cm.Day(e,t)),e=e.clone(),e.add(1,"d");return n}function r(e){console.log("calendarCache");var t={get currentDay(){var t=e.get("currentDay");return t||(t=moment()),moment(t)},set currentDay(t){e.put("currentDay",t.toString())}};return t}function i(){var e={restrict:"AE",templateUrl:"events/event-calendar.html",replace:!0,controller:o,controllerAs:"vm",bindToController:!0};return e}function o(e,t){function n(){t.currentDay=r.currentDay,r.monthName=r.currentDay.format("MMMM"),r.year=r.currentDay.year(),e.events(r.currentDay.year(),r.currentDay.month()).then(function(e){r.calendar=e})}function a(e){e>0?r.currentDay.add(e,"months"):r.currentDay.subtract(Math.abs(e),"months"),n()}var r=this;r.calendar=null,r.currentDay=t.currentDay.clone(),r.changeMonth=a,n()}function c(e,t){function n(n,r){var i=t.api+"events/";return n&&(i=i+"?year="+n),n&&r&&(i=i+"&month="+r),e.get(i,{cache:!0}).then(a)}function a(e){return e.data}function r(){var n=t.api+"upcoming-events/";return e.get(n,{cache:!0}).then(i)}function i(e){return e.data}var o={events:n,upcoming:r};return o}function s(e){function t(t,n){return e.events(t,n+1).then(function(e){var a=new ClubManager.Calendar(n,t);return e.forEach(function(e){a.addEvent(e)}),a})}function n(){var t=(new Date).getFullYear();return e.events(t).then(function(e){var n=e.filter(function(e){return moment(e.start_date).year()===t&&("registration"===e.event_state||"pending"===e.event_state)});return n})}var a={events:t,upcoming:n};return a}function l(){var e={restrict:"AE",templateUrl:"events/upcoming-events.html",replace:!0,controller:u,controllerAs:"vm",bindToController:!0};return e}function u(e){function t(){e.upcoming().then(function(e){a.events=e.map(function(e){var t=moment(e.start_date).format("MMM D"),a=moment(e.start_time,"hh:mm").format("h:mm A"),r=n(e);return{id:e.id,url:e.url,name:e.name,start_date:t,start_time:a,time_left:r}})})}function n(e){var t=moment(),n=moment(e.signup_end),a=n.diff(t,"days");if(a>0)return a+" days left to sign up";var r=n.diff(t,"hours");return r>0?r+" hours left to sign up":"Signup window closed at "+n.format("h:mm A")}var a=this;a.events=[],t()}angular.module("club-manager").controller("AppController",e),e.$inject=["$location"],angular.module("club-manager").run(["$templateCache",function(e){e.put("events/event-calendar.html",'<div id=calendar-wrap><header><div class=month-title><span ng-click=vm.changeMonth(-1)>&lt;</span>{{vm.monthName}} {{vm.year}}<span ng-click=vm.changeMonth(1)>&gt;</span></div></header><div id=calendar><ul class=weekdays><li>Sunday</li><li>Monday</li><li>Tuesday</li><li>Wednesday</li><li>Thursday</li><li>Friday</li><li>Saturday</li></ul><ul ng-repeat="week in vm.calendar.weeks" class=days><li ng-repeat="d in week.days" class=day ng-class="{\'other-month\': !d.isCurrentMonth}"><div class=date>{{d.day}}</div><div ng-repeat="e in d.events" class=event><div class=event-desc><a href="/event/{{ e.id }}/">{{e.name}}</a></div></div></li></ul></div></div>'),e.put("events/upcoming-events.html",'<li class="dropdown hidden-xs"><a href data-toggle=dropdown class=hi-events><i class="zmdi zmdi-calendar"></i></a><div class="dropdown-menu hi-dropdown"><div class="dropdown-header bg-blue m-b-15">UPCOMING EVENTS</div><div ng-show="vm.events.length === 0" class="list-group lg-alt">No events are available for registration at this time.</div><div ng-show="vm.events.length > 0" ng-repeat="e in vm.events" class="list-group lg-alt"><a class="list-group-item media" href="/event/{{ e.id }}/register/"><div class=pull-left><div class="event-time bg-green"><h2>{{ e.start_date }}</h2><small>{{ e.start_time }}</small></div></div><div class=media-body><div class=list-group-item-heading>{{ e.name }}</div><small class="list-group-item-text c-gray f-11">{{ e.time_left }}</small></div></a></div><a class=view-more href="/calendar/">View all</a></div></li>')}]),function(){function e(e){var t="/";"localhost"===e.location.host.toLowerCase()&&(t="/");var n={get root(){return t},get api(){return t+"api/"},get admin(){return t+"admin/"}};return n}angular.module("club-manager").factory("host",e),e.$inject=["$window"]}();var d=function(e,a){var r=t(e,a);this.weeks=n(r,moment([a,e,1]))},m=function(e){var t=moment(e.signup_start),n=moment(e.signup_end);return e.canRegister=moment().isBetween(t,n),e.hasResults=moment().isAfter(e.start_date),e},v=function(e,t){var n=moment(t.start_date);e.weeks.forEach(function(e){e.days.forEach(function(e){e.date.isSame(n,"day")&&e.events.push(m(t))})})};d.prototype={constructor:d,addEvent:function(e){v(this,e)}},ClubManager.Calendar=calendar;var h=function(e,t){this.name=e.format("dddd"),this.shortName=e.format("ddd"),this.day=parseInt(e.format("D"),10),this.isCurrentMonth=e.month()===t.month(),this.isToday=e.isSame(new Date,"day"),this.date=e,this.events=[]};h.prototype={constructor:calendarDay,hasEvents:function(){return this.events&&this.events.length>0},addEvent:function(e){addEvent(this,e)}},ClubManager.Day=h,angular.module("club-manager").factory("calendarCache",r),r.$inject=["$cookies"],angular.module("club-manager").directive("eventCalendar",i),o.$inject=["eventService","calendarCache"],angular.module("club-manager").factory("eventData",c),c.$inject=["$http","host"],angular.module("club-manager").factory("eventService",s),s.$inject=["eventData"],angular.module("club-manager").directive("upcomingEvents",l),u.$inject=["eventService"]}();